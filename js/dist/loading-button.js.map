{"version":3,"file":"loading-button.js","sources":["../src/loading-button.js"],"sourcesContent":["/**\n * --------------------------------------------------------------------------\n * CoreUI PRO loading-button.js\n * License (https://coreui.io/pro/license/)\n * --------------------------------------------------------------------------\n */\n\nimport BaseComponent from './base-component.js'\nimport Data from './dom/data.js'\nimport EventHandler from './dom/event-handler.js'\nimport { defineJQueryPlugin } from './util/index.js'\n\n/**\n * Constants\n */\n\nconst NAME = 'loading-button'\nconst DATA_KEY = 'coreui.loading-button'\nconst EVENT_KEY = `.${DATA_KEY}`\nconst DATA_API_KEY = '.data-api'\n\nconst EVENT_START = `start${EVENT_KEY}`\nconst EVENT_STOP = `stop${EVENT_KEY}`\nconst EVENT_CLICK_DATA_API = `click${EVENT_KEY}${DATA_API_KEY}`\n\nconst CLASS_NAME_IS_LOADING = 'is-loading'\nconst CLASS_NAME_LOADING_BUTTON = 'btn-loading'\nconst CLASS_NAME_LOADING_BUTTON_SPINNER = 'btn-loading-spinner'\n\nconst SELECTOR_DATA_TOGGLE = '[data-coreui-toggle=\"loading-button\"]'\n\nconst Default = {\n  disabledOnLoading: false,\n  spinner: true,\n  spinnerType: 'border',\n  timeout: false\n}\n\nconst DefaultType = {\n  disabledOnLoading: 'boolean',\n  spinner: 'boolean',\n  spinnerType: 'string',\n  timeout: '(boolean|number)'\n}\n\n/**\n * Class definition\n */\n\nclass LoadingButton extends BaseComponent {\n  constructor(element, config) {\n    super(element)\n\n    this._config = this._getConfig(config)\n    this._timeout = this._config.timeout\n    this._spinner = null\n    this._state = 'idle'\n\n    if (this._element) {\n      Data.set(element, DATA_KEY, this)\n    }\n\n    this._createButton()\n  }\n\n  // Getters\n\n  static get Default() {\n    return Default\n  }\n\n  static get DefaultType() {\n    return DefaultType\n  }\n\n  static get NAME() {\n    return NAME\n  }\n\n  // Public\n\n  start() {\n    if (this._state !== 'loading') {\n      this._createSpinner()\n      this._state = 'loading'\n\n      setTimeout(() => {\n        this._element.classList.add(CLASS_NAME_IS_LOADING)\n        EventHandler.trigger(this._element, EVENT_START)\n\n        if (this._config.disabledOnLoading) {\n          this._element.setAttribute('disabled', true)\n        }\n      }, 1)\n\n      if (this._config.timeout) {\n        setTimeout(() => {\n          this.stop()\n        }, this._config.timeout)\n      }\n    }\n  }\n\n  stop() {\n    this._element.classList.remove(CLASS_NAME_IS_LOADING)\n    const stoped = () => {\n      this._removeSpinner()\n      this._state = 'idle'\n\n      if (this._config.disabledOnLoading) {\n        this._element.removeAttribute('disabled')\n      }\n\n      EventHandler.trigger(this._element, EVENT_STOP)\n    }\n\n    if (this._spinner) {\n      this._queueCallback(stoped, this._spinner, true)\n      return\n    }\n\n    stoped()\n  }\n\n  dispose() {\n    Data.removeData(this._element, DATA_KEY)\n    this._element = null\n  }\n\n  _createButton() {\n    this._element.classList.add(CLASS_NAME_LOADING_BUTTON)\n  }\n\n  _createSpinner() {\n    if (this._config.spinner) {\n      const spinner = document.createElement('span')\n      const type = this._config.spinnerType\n      spinner.classList.add(CLASS_NAME_LOADING_BUTTON_SPINNER, `spinner-${type}`, `spinner-${type}-sm`)\n      spinner.setAttribute('role', 'status')\n      spinner.setAttribute('aria-hidden', 'true')\n      this._element.insertBefore(spinner, this._element.firstChild)\n      this._spinner = spinner\n    }\n  }\n\n  _removeSpinner() {\n    if (this._config.spinner) {\n      this._spinner.remove()\n      this._spinner = null\n    }\n  }\n\n  // Static\n\n  static loadingButtonInterface(element, config) {\n    const data = LoadingButton.getOrCreateInstance(element, config)\n\n    if (typeof config === 'string') {\n      if (typeof data[config] === 'undefined') {\n        throw new TypeError(`No method named \"${config}\"`)\n      }\n\n      data[config]()\n    }\n  }\n\n  static jQueryInterface(config) {\n    return this.each(function () {\n      LoadingButton.loadingButtonInterface(this, config)\n    })\n  }\n}\n\n/**\n * Data API implementation\n */\n\nEventHandler.on(document, EVENT_CLICK_DATA_API, SELECTOR_DATA_TOGGLE, event => {\n  event.preventDefault()\n  const button = event.target.closest(SELECTOR_DATA_TOGGLE)\n  const data = LoadingButton.getOrCreateInstance(button)\n\n  data.start()\n})\n\n/**\n * jQuery\n */\n\ndefineJQueryPlugin(LoadingButton)\n\nexport default LoadingButton\n"],"names":["NAME","DATA_KEY","EVENT_KEY","DATA_API_KEY","EVENT_START","EVENT_STOP","EVENT_CLICK_DATA_API","CLASS_NAME_IS_LOADING","CLASS_NAME_LOADING_BUTTON","CLASS_NAME_LOADING_BUTTON_SPINNER","SELECTOR_DATA_TOGGLE","Default","disabledOnLoading","spinner","spinnerType","timeout","DefaultType","LoadingButton","BaseComponent","constructor","element","config","_config","_getConfig","_timeout","_spinner","_state","_element","Data","set","_createButton","start","_createSpinner","setTimeout","classList","add","EventHandler","trigger","setAttribute","stop","remove","stoped","_removeSpinner","removeAttribute","_queueCallback","dispose","removeData","document","createElement","type","insertBefore","firstChild","loadingButtonInterface","data","getOrCreateInstance","TypeError","jQueryInterface","each","on","event","preventDefault","button","target","closest","defineJQueryPlugin"],"mappings":"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"}