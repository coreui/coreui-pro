{"version":3,"file":"loading-button.js","sources":["../src/loading-button.js"],"sourcesContent":["/**\n * --------------------------------------------------------------------------\n * CoreUI PRO loading-button.js\n * License (https://coreui.io/pro/license/)\n * --------------------------------------------------------------------------\n */\n\nimport BaseComponent from './base-component.js'\nimport Data from './dom/data.js'\nimport EventHandler from './dom/event-handler.js'\nimport Manipulator from './dom/manipulator.js'\nimport { defineJQueryPlugin } from './util/index.js'\n\n/**\n * Constants\n */\n\nconst NAME = 'loading-button'\nconst DATA_KEY = 'coreui.loading-button'\nconst EVENT_KEY = `.${DATA_KEY}`\nconst DATA_API_KEY = '.data-api'\n\nconst EVENT_START = `start${EVENT_KEY}`\nconst EVENT_STOP = `stop${EVENT_KEY}`\nconst EVENT_CLICK_DATA_API = `click${EVENT_KEY}${DATA_API_KEY}`\n\nconst CLASS_NAME_IS_LOADING = 'is-loading'\nconst CLASS_NAME_LOADING_BUTTON_SPINNER = 'btn-loading-spinner'\n\nconst SELECTOR_DATA_TOGGLE = '[data-coreui-toggle=\"loading-button\"]'\n\nconst Default = {\n  disabledOnLoading: false,\n  spinner: true,\n  spinnerType: 'border',\n  timeout: false\n}\n\nconst DefaultType = {\n  disabledOnLoading: 'boolean',\n  spinner: 'boolean',\n  spinnerType: 'string',\n  timeout: '(boolean|number)'\n}\n\n/**\n * Class definition\n */\n\nclass LoadingButton extends BaseComponent {\n  constructor(element, config) {\n    super(element)\n\n    this._config = this._getConfig(config)\n    this._timeout = this._config.timeout\n    this._spinner = null\n    this._state = 'idle'\n\n    if (this._element) {\n      Data.set(element, DATA_KEY, this)\n    }\n  }\n\n  // Getters\n\n  static get Default() {\n    return Default\n  }\n\n  static get DefaultType() {\n    return DefaultType\n  }\n\n  static get NAME() {\n    return NAME\n  }\n\n  // Public\n\n  start() {\n    if (this._state !== 'loading') {\n      this._createSpinner()\n      this._state = 'loading'\n\n      setTimeout(() => {\n        this._element.classList.add(CLASS_NAME_IS_LOADING)\n        EventHandler.trigger(this._element, EVENT_START)\n\n        if (this._config.disabledOnLoading) {\n          this._element.setAttribute('disabled', true)\n        }\n      }, 1)\n\n      if (this._config.timeout) {\n        setTimeout(() => {\n          this.stop()\n        }, this._config.timeout)\n      }\n    }\n  }\n\n  stop() {\n    this._element.classList.remove(CLASS_NAME_IS_LOADING)\n    const stoped = () => {\n      this._removeSpinner()\n      this._state = 'idle'\n\n      if (this._config.disabledOnLoading) {\n        this._element.removeAttribute('disabled')\n      }\n\n      EventHandler.trigger(this._element, EVENT_STOP)\n    }\n\n    if (this._spinner) {\n      this._queueCallback(stoped, this._spinner, true)\n      return\n    }\n\n    stoped()\n  }\n\n  dispose() {\n    Data.removeData(this._element, DATA_KEY)\n    this._element = null\n  }\n\n  _getConfig(config) {\n    config = {\n      ...Default,\n      ...Manipulator.getDataAttributes(this._element),\n      ...(typeof config === 'object' ? config : {})\n    }\n\n    return config\n  }\n\n  _createSpinner() {\n    if (this._config.spinner) {\n      const spinner = document.createElement('span')\n      const type = this._config.spinnerType\n      spinner.classList.add(CLASS_NAME_LOADING_BUTTON_SPINNER, `spinner-${type}`, `spinner-${type}-sm`)\n      spinner.setAttribute('role', 'status')\n      spinner.setAttribute('aria-hidden', 'true')\n      this._element.insertBefore(spinner, this._element.firstChild)\n      this._spinner = spinner\n    }\n  }\n\n  _removeSpinner() {\n    if (this._config.spinner) {\n      this._spinner.remove()\n      this._spinner = null\n    }\n  }\n\n  // Static\n\n  static loadingButtonInterface(element, config) {\n    const data = LoadingButton.getOrCreateInstance(element, config)\n\n    if (typeof config === 'string') {\n      if (typeof data[config] === 'undefined') {\n        throw new TypeError(`No method named \"${config}\"`)\n      }\n\n      data[config]()\n    }\n  }\n\n  static jQueryInterface(config) {\n    return this.each(function () {\n      LoadingButton.loadingButtonInterface(this, config)\n    })\n  }\n}\n\n/**\n * Data API implementation\n */\n\nEventHandler.on(document, EVENT_CLICK_DATA_API, SELECTOR_DATA_TOGGLE, event => {\n  event.preventDefault()\n  const button = event.target.closest(SELECTOR_DATA_TOGGLE)\n  const data = LoadingButton.getOrCreateInstance(button)\n\n  data.start()\n})\n\n/**\n * jQuery\n */\n\ndefineJQueryPlugin(LoadingButton)\n\nexport default LoadingButton\n"],"names":["NAME","DATA_KEY","EVENT_KEY","DATA_API_KEY","EVENT_START","EVENT_STOP","EVENT_CLICK_DATA_API","CLASS_NAME_IS_LOADING","CLASS_NAME_LOADING_BUTTON_SPINNER","SELECTOR_DATA_TOGGLE","Default","disabledOnLoading","spinner","spinnerType","timeout","DefaultType","LoadingButton","BaseComponent","constructor","element","config","_config","_getConfig","_timeout","_spinner","_state","_element","Data","set","start","_createSpinner","setTimeout","classList","add","EventHandler","trigger","setAttribute","stop","remove","stoped","_removeSpinner","removeAttribute","_queueCallback","dispose","removeData","Manipulator","getDataAttributes","document","createElement","type","insertBefore","firstChild","loadingButtonInterface","data","getOrCreateInstance","TypeError","jQueryInterface","each","on","event","preventDefault","button","target","closest","defineJQueryPlugin"],"mappings":"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"}