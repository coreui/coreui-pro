{"version":3,"file":"focustrap.js","sources":["../../src/util/focustrap.js"],"sourcesContent":["/**\n * --------------------------------------------------------------------------\n * CoreUI util/focustrap.js\n * Licensed under MIT (https://github.com/coreui/coreui/blob/main/LICENSE)\n *\n * This is a modified version of the Bootstrap's util/focustrap.js\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)\n * --------------------------------------------------------------------------\n */\n\nimport EventHandler from '../dom/event-handler.js'\nimport SelectorEngine from '../dom/selector-engine.js'\nimport Config from './config.js'\n\n/**\n * Constants\n */\n\nconst NAME = 'focustrap'\nconst DATA_KEY = 'coreui.focustrap'\nconst EVENT_KEY = `.${DATA_KEY}`\nconst EVENT_FOCUSIN = `focusin${EVENT_KEY}`\nconst EVENT_KEYDOWN_TAB = `keydown.tab${EVENT_KEY}`\n\nconst TAB_KEY = 'Tab'\nconst TAB_NAV_FORWARD = 'forward'\nconst TAB_NAV_BACKWARD = 'backward'\n\nconst Default = {\n  additionalElement: null,\n  autofocus: true,\n  trapElement: null // The element to trap focus inside of\n}\n\nconst DefaultType = {\n  additionalElement: '(element|null|undefined)',\n  autofocus: 'boolean',\n  trapElement: 'element'\n}\n\n/**\n * Class definition\n */\n\nclass FocusTrap extends Config {\n  constructor(config) {\n    super()\n    this._config = this._getConfig(config)\n    this._isActive = false\n    this._lastTabNavDirection = null\n  }\n\n  // Getters\n  static get Default() {\n    return Default\n  }\n\n  static get DefaultType() {\n    return DefaultType\n  }\n\n  static get NAME() {\n    return NAME\n  }\n\n  // Public\n  activate() {\n    if (this._isActive) {\n      return\n    }\n\n    if (this._config.autofocus) {\n      this._config.trapElement.focus()\n    }\n\n    EventHandler.off(document, EVENT_KEY) // guard against infinite focus loop\n    EventHandler.on(document, EVENT_FOCUSIN, event => this._handleFocusin(event))\n    EventHandler.on(document, EVENT_KEYDOWN_TAB, event => this._handleKeydown(event))\n\n    this._isActive = true\n  }\n\n  deactivate() {\n    if (!this._isActive) {\n      return\n    }\n\n    this._isActive = false\n    EventHandler.off(document, EVENT_KEY)\n  }\n\n  // Private\n  _handleFocusin(event) {\n    const { additionalElement, trapElement } = this._config\n\n    if (event.target === document || event.target === trapElement || trapElement.contains(event.target)) {\n      return\n    }\n\n    if (additionalElement && (event.target === additionalElement || additionalElement.contains(event.target))) {\n      return\n    }\n\n    const elements = SelectorEngine.focusableChildren(trapElement)\n\n    if (elements.length === 0) {\n      trapElement.focus()\n    } else if (this._lastTabNavDirection === TAB_NAV_BACKWARD) {\n      elements[elements.length - 1].focus()\n    } else {\n      elements[0].focus()\n    }\n  }\n\n  _handleKeydown(event) {\n    if (event.key !== TAB_KEY) {\n      return\n    }\n\n    this._lastTabNavDirection = event.shiftKey ? TAB_NAV_BACKWARD : TAB_NAV_FORWARD\n\n    const { additionalElement, trapElement } = this._config\n\n    if (!additionalElement) {\n      return\n    }\n\n    const trapElements = SelectorEngine.focusableChildren(trapElement)\n    const additionalElements = SelectorEngine.focusableChildren(additionalElement)\n\n    if (trapElements.length === 0 || additionalElements.length === 0) {\n      return\n    }\n\n    event.preventDefault()\n\n    if (trapElements.indexOf(event.target) === trapElements.length - 1 && !event.shiftKey) {\n      additionalElements[0].focus()\n      return\n    }\n\n    if (trapElements.indexOf(event.target) === 0 && event.shiftKey) {\n      additionalElements[additionalElements.length - 1].focus()\n      return\n    }\n\n    if (additionalElements.indexOf(event.target) === additionalElements.length - 1 && !event.shiftKey) {\n      trapElements[0].focus()\n      return\n    }\n\n    if (additionalElements.indexOf(event.target) === 0 && event.shiftKey) {\n      trapElements[trapElements.length - 1].focus()\n    }\n  }\n}\n\nexport default FocusTrap\n"],"names":["NAME","DATA_KEY","EVENT_KEY","EVENT_FOCUSIN","EVENT_KEYDOWN_TAB","TAB_KEY","TAB_NAV_FORWARD","TAB_NAV_BACKWARD","Default","additionalElement","autofocus","trapElement","DefaultType","FocusTrap","Config","constructor","config","_config","_getConfig","_isActive","_lastTabNavDirection","activate","focus","EventHandler","off","document","on","event","_handleFocusin","_handleKeydown","deactivate","target","contains","elements","SelectorEngine","focusableChildren","length","key","shiftKey","trapElements","additionalElements","preventDefault","indexOf"],"mappings":"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"}